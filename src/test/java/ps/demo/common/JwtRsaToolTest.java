package ps.demo.common;

import cn.hutool.core.lang.Console;
import com.google.common.collect.ImmutableMap;
import org.junit.jupiter.api.Test;

import java.security.NoSuchAlgorithmException;
import java.security.spec.InvalidKeySpecException;
import java.time.Instant;
import java.time.temporal.TemporalUnit;
import java.util.Date;
import java.util.List;

import static org.junit.jupiter.api.Assertions.*;

class JwtRsaToolTest {

    @Test
    void generatePrivatePublicKeyPair() throws NoSuchAlgorithmException {
        List<String> privPubKeys = JwtRsaTool.generatePrivatePublicKeyPair();
        StringXTool.printOut(privPubKeys);
        /**
         *
         [0] MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCqRNECqRE+zOu1TuXoVIGhrL9jbVsnATpT3Ruuw87gCBHSpzzhSPLo/aLnM5tui8QmJkVg76svyqScxuiQkRe4tY7gGu9Tr0JmwIETdh0zgKj3uPbdzezZpHXh1o3ERmgdToqgF8pah6HaWA5j/wghKegs30ZGdO43Pkiey74N4kNqJfjrYcY/oIzqz0OoWqo4u6wXhUI8nvypRyefwCxaN50cNVkGnsoT5A39LsdCLdHGDEG+8Vi1YqtQS4XjdIfh47ezPHJl+UgtJZ1goXglShGfQnPwI6+HCeXrLGYU/Kf/EeJUcoQFm6hg+EtZrqkzLgzMMExWmfer+YzNzcHVAgMBAAECggEAB4pRNPWGn7MQEb7cJ502cG1Vc03CweyVtdIzLez/GqTA15dYZJGsveyv2ZVLfWpY1fnz53Q1rtQh+YP8YJzemKJRsy5r5SBFOj1kMM661FNYA64ksuFWj9hKXdxB+dDrPtxvkXP8Qq4UtEhjKHlcjISSlVNHF7jSf0WDaclveu7+AvA85PBluB19A3wHbn9YFi27LjvXcTARZLPnlupbMprcPUhScAaaUE3vXkEgREWyJDuKDW22xFfBYpPgJ6R5oQFKue5Zq8AFEtfbYVWYI2zL/sHjy7mYAWfURcWVdnyFeSmiFD6vqzoORo5Sv34sZZ44yaIfa4f8gru5s1NgsQKBgQDXNwJzwKEcb/Oi9kxapYCA5lQXORkINQ0NpS16NTRBBMOPIKIG61qyV+HVheyKS24Lvr2otwmDyVGtvcQrfyfFEx7p937Mp/eh0vdP8Jk5XRPfzjkosi+oUWc+sbNyzp7UIwavRK9xbi2OkCQPZWRWqiZ+owUYnPM1+yqma80m2wKBgQDKiUggwo4gQ9Mr5ec1TQ2ysEwkkpnlT6PZ7gKEMHYPL9JpTS4IvRIWa2QvBg8brMj8chCZ9B4ZY/SpmIQwTAAJCmQAggjVl3Mi8xLjbz2X9P0Joj8m2/9KvOIDhgXlW3Y5+t5oORNscZN391XB3iHbpsnmrq7qJCf84Gs2tYbhDwKBgFarz7AAHqIOL+csG5nR1wuSNsFXfE5C1yvsnoD91jptCbilYrs4o0D5hXhxQ856DCpsuYKtnAZX2C4JI2yE++YxCh0dUBJpfp/MD09BTOO+KVfTfE94WxsFFXg5JlSRA4PZS0LgfWtH/M7SG8ObiKoiQfhz/IRqCMRvj0CQX4FLAoGBAIbHbHRAhAv8lp5z07SoniD3KPR9imQK52Ky/IGzLh1VGZRxg9zU1SCOPpD8WzlzdhxoW5vX09/ZoIrrr6vkJ3HctEeSQQbCTiBH2Z33/OkOYwTyL0xQwkaeA1mM6oeCod5bj32T3dUgj54ZvbvRcn6VM26LeGLfxKyHO1Gg4y0JAoGAZOxkprzwPBpaa19X5976R+eLgKmFHPr43kfTeRFzjoBIM8WlksUBF6HSbl+CPvgckeu+MnpHpIGZNZBOCgbtaspFVcUXkYxlK194O3DHDjBI9LNRzAjG4YSpmeqIxQqIYKuLnfWZZTUNtcFNsoY8jJRjND8cJuI5qZE77lfL9qc=
         [1] MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqkTRAqkRPszrtU7l6FSBoay/Y21bJwE6U90brsPO4AgR0qc84Ujy6P2i5zObbovEJiZFYO+rL8qknMbokJEXuLWO4BrvU69CZsCBE3YdM4Co97j23c3s2aR14daNxEZoHU6KoBfKWoeh2lgOY/8IISnoLN9GRnTuNz5Insu+DeJDaiX462HGP6CM6s9DqFqqOLusF4VCPJ78qUcnn8AsWjedHDVZBp7KE+QN/S7HQi3RxgxBvvFYtWKrUEuF43SH4eO3szxyZflILSWdYKF4JUoRn0Jz8COvhwnl6yxmFPyn/xHiVHKEBZuoYPhLWa6pMy4MzDBMVpn3q/mMzc3B1QIDAQAB

         */
    }

    @Test
    void getRSAPrivateKeyObj() {
    }

    @Test
    void getRSAPublicKeyObj() {
    }

    @Test
    void generateJwtTokenWithRSA() throws NoSuchAlgorithmException, InvalidKeySpecException {
        List<String> privPubKeys = List.of("MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCqRNECqRE+zOu1TuXoVIGhrL9jbVsnATpT3Ruuw87gCBHSpzzhSPLo/aLnM5tui8QmJkVg76svyqScxuiQkRe4tY7gGu9Tr0JmwIETdh0zgKj3uPbdzezZpHXh1o3ERmgdToqgF8pah6HaWA5j/wghKegs30ZGdO43Pkiey74N4kNqJfjrYcY/oIzqz0OoWqo4u6wXhUI8nvypRyefwCxaN50cNVkGnsoT5A39LsdCLdHGDEG+8Vi1YqtQS4XjdIfh47ezPHJl+UgtJZ1goXglShGfQnPwI6+HCeXrLGYU/Kf/EeJUcoQFm6hg+EtZrqkzLgzMMExWmfer+YzNzcHVAgMBAAECggEAB4pRNPWGn7MQEb7cJ502cG1Vc03CweyVtdIzLez/GqTA15dYZJGsveyv2ZVLfWpY1fnz53Q1rtQh+YP8YJzemKJRsy5r5SBFOj1kMM661FNYA64ksuFWj9hKXdxB+dDrPtxvkXP8Qq4UtEhjKHlcjISSlVNHF7jSf0WDaclveu7+AvA85PBluB19A3wHbn9YFi27LjvXcTARZLPnlupbMprcPUhScAaaUE3vXkEgREWyJDuKDW22xFfBYpPgJ6R5oQFKue5Zq8AFEtfbYVWYI2zL/sHjy7mYAWfURcWVdnyFeSmiFD6vqzoORo5Sv34sZZ44yaIfa4f8gru5s1NgsQKBgQDXNwJzwKEcb/Oi9kxapYCA5lQXORkINQ0NpS16NTRBBMOPIKIG61qyV+HVheyKS24Lvr2otwmDyVGtvcQrfyfFEx7p937Mp/eh0vdP8Jk5XRPfzjkosi+oUWc+sbNyzp7UIwavRK9xbi2OkCQPZWRWqiZ+owUYnPM1+yqma80m2wKBgQDKiUggwo4gQ9Mr5ec1TQ2ysEwkkpnlT6PZ7gKEMHYPL9JpTS4IvRIWa2QvBg8brMj8chCZ9B4ZY/SpmIQwTAAJCmQAggjVl3Mi8xLjbz2X9P0Joj8m2/9KvOIDhgXlW3Y5+t5oORNscZN391XB3iHbpsnmrq7qJCf84Gs2tYbhDwKBgFarz7AAHqIOL+csG5nR1wuSNsFXfE5C1yvsnoD91jptCbilYrs4o0D5hXhxQ856DCpsuYKtnAZX2C4JI2yE++YxCh0dUBJpfp/MD09BTOO+KVfTfE94WxsFFXg5JlSRA4PZS0LgfWtH/M7SG8ObiKoiQfhz/IRqCMRvj0CQX4FLAoGBAIbHbHRAhAv8lp5z07SoniD3KPR9imQK52Ky/IGzLh1VGZRxg9zU1SCOPpD8WzlzdhxoW5vX09/ZoIrrr6vkJ3HctEeSQQbCTiBH2Z33/OkOYwTyL0xQwkaeA1mM6oeCod5bj32T3dUgj54ZvbvRcn6VM26LeGLfxKyHO1Gg4y0JAoGAZOxkprzwPBpaa19X5976R+eLgKmFHPr43kfTeRFzjoBIM8WlksUBF6HSbl+CPvgckeu+MnpHpIGZNZBOCgbtaspFVcUXkYxlK194O3DHDjBI9LNRzAjG4YSpmeqIxQqIYKuLnfWZZTUNtcFNsoY8jJRjND8cJuI5qZE77lfL9qc=",
                "MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqkTRAqkRPszrtU7l6FSBoay/Y21bJwE6U90brsPO4AgR0qc84Ujy6P2i5zObbovEJiZFYO+rL8qknMbokJEXuLWO4BrvU69CZsCBE3YdM4Co97j23c3s2aR14daNxEZoHU6KoBfKWoeh2lgOY/8IISnoLN9GRnTuNz5Insu+DeJDaiX462HGP6CM6s9DqFqqOLusF4VCPJ78qUcnn8AsWjedHDVZBp7KE+QN/S7HQi3RxgxBvvFYtWKrUEuF43SH4eO3szxyZflILSWdYKF4JUoRn0Jz8COvhwnl6yxmFPyn/xHiVHKEBZuoYPhLWa6pMy4MzDBMVpn3q/mMzc3B1QIDAQAB");
        String jwtToken = JwtRsaTool.generateJwtTokenWithRSA(privPubKeys, "sub1", ImmutableMap.of("c1", 1, "c2", new Date()),
                "issuer1", Instant.now().plusSeconds(600));
        Console.log("jwtToken=\"{}\";", jwtToken);
    }

    @Test
    void verifyJwtToken() {
        String jwtToken="eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdWIxIiwiaXNzIjoiaXNzdWVyMSIsImV4cCI6MTcxMzc1OTE3MX0.nqWaVaMsFo8dV1edL8cQ4y9mJzWsMYhYGXlUjwry-fGBy9NwQNk1dIj3-vwLShISsA4CfGyUcCu6JXz4KYoOr4G5uxV-LDx2_S_OCI_org-W4BcsxvFeOWrg56r6y525uHL05-LcQzkCG3nq8XR1coNOeGaElcRraIR7H46TJ1TvccNNy34NaeVyJ8rQPoUsyErHs-ZPBSYqw-nZemz7EmZG6AOfBZ0JKALHhjiIV5vomA8gmSIzqL7LnRPiiyg_ik4FaAazQCpSGHMMa0I4XblQhHqQkH0pDU1NGpLmNoVy28udQNp2dYOt1uBrab9b7-vpxTD2LswWVH-rzfytog";

        List<String> privPubKeys = List.of("MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCqRNECqRE+zOu1TuXoVIGhrL9jbVsnATpT3Ruuw87gCBHSpzzhSPLo/aLnM5tui8QmJkVg76svyqScxuiQkRe4tY7gGu9Tr0JmwIETdh0zgKj3uPbdzezZpHXh1o3ERmgdToqgF8pah6HaWA5j/wghKegs30ZGdO43Pkiey74N4kNqJfjrYcY/oIzqz0OoWqo4u6wXhUI8nvypRyefwCxaN50cNVkGnsoT5A39LsdCLdHGDEG+8Vi1YqtQS4XjdIfh47ezPHJl+UgtJZ1goXglShGfQnPwI6+HCeXrLGYU/Kf/EeJUcoQFm6hg+EtZrqkzLgzMMExWmfer+YzNzcHVAgMBAAECggEAB4pRNPWGn7MQEb7cJ502cG1Vc03CweyVtdIzLez/GqTA15dYZJGsveyv2ZVLfWpY1fnz53Q1rtQh+YP8YJzemKJRsy5r5SBFOj1kMM661FNYA64ksuFWj9hKXdxB+dDrPtxvkXP8Qq4UtEhjKHlcjISSlVNHF7jSf0WDaclveu7+AvA85PBluB19A3wHbn9YFi27LjvXcTARZLPnlupbMprcPUhScAaaUE3vXkEgREWyJDuKDW22xFfBYpPgJ6R5oQFKue5Zq8AFEtfbYVWYI2zL/sHjy7mYAWfURcWVdnyFeSmiFD6vqzoORo5Sv34sZZ44yaIfa4f8gru5s1NgsQKBgQDXNwJzwKEcb/Oi9kxapYCA5lQXORkINQ0NpS16NTRBBMOPIKIG61qyV+HVheyKS24Lvr2otwmDyVGtvcQrfyfFEx7p937Mp/eh0vdP8Jk5XRPfzjkosi+oUWc+sbNyzp7UIwavRK9xbi2OkCQPZWRWqiZ+owUYnPM1+yqma80m2wKBgQDKiUggwo4gQ9Mr5ec1TQ2ysEwkkpnlT6PZ7gKEMHYPL9JpTS4IvRIWa2QvBg8brMj8chCZ9B4ZY/SpmIQwTAAJCmQAggjVl3Mi8xLjbz2X9P0Joj8m2/9KvOIDhgXlW3Y5+t5oORNscZN391XB3iHbpsnmrq7qJCf84Gs2tYbhDwKBgFarz7AAHqIOL+csG5nR1wuSNsFXfE5C1yvsnoD91jptCbilYrs4o0D5hXhxQ856DCpsuYKtnAZX2C4JI2yE++YxCh0dUBJpfp/MD09BTOO+KVfTfE94WxsFFXg5JlSRA4PZS0LgfWtH/M7SG8ObiKoiQfhz/IRqCMRvj0CQX4FLAoGBAIbHbHRAhAv8lp5z07SoniD3KPR9imQK52Ky/IGzLh1VGZRxg9zU1SCOPpD8WzlzdhxoW5vX09/ZoIrrr6vkJ3HctEeSQQbCTiBH2Z33/OkOYwTyL0xQwkaeA1mM6oeCod5bj32T3dUgj54ZvbvRcn6VM26LeGLfxKyHO1Gg4y0JAoGAZOxkprzwPBpaa19X5976R+eLgKmFHPr43kfTeRFzjoBIM8WlksUBF6HSbl+CPvgckeu+MnpHpIGZNZBOCgbtaspFVcUXkYxlK194O3DHDjBI9LNRzAjG4YSpmeqIxQqIYKuLnfWZZTUNtcFNsoY8jJRjND8cJuI5qZE77lfL9qc=",
                "MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqkTRAqkRPszrtU7l6FSBoay/Y21bJwE6U90brsPO4AgR0qc84Ujy6P2i5zObbovEJiZFYO+rL8qknMbokJEXuLWO4BrvU69CZsCBE3YdM4Co97j23c3s2aR14daNxEZoHU6KoBfKWoeh2lgOY/8IISnoLN9GRnTuNz5Insu+DeJDaiX462HGP6CM6s9DqFqqOLusF4VCPJ78qUcnn8AsWjedHDVZBp7KE+QN/S7HQi3RxgxBvvFYtWKrUEuF43SH4eO3szxyZflILSWdYKF4JUoRn0Jz8COvhwnl6yxmFPyn/xHiVHKEBZuoYPhLWa6pMy4MzDBMVpn3q/mMzc3B1QIDAQAB");
        Boolean isValid = JwtRsaTool.verifyJwtToken(jwtToken, privPubKeys.get(1));
        Console.log("isValid={}", isValid);
    }
}